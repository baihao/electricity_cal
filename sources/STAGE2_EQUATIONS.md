# Stage 2 (200微秒-50毫秒) 电路方程分析

## 电路拓扑

```
电流源 i_s(t)
    ↓
    ├─→ L-D1-D2-SCR1 (电感L和电子旁路串联)
    ├─→ R (电阻)
    └─→ C (电容)
    ↓
    Rg
    ↓
    地
```

**注意**：L和D1-D2-SCR1是**串联**的，组成一个支路，然后与R、C**并联**。

## 电路参数

- C = 36 mF = 0.036 F
- R = 500 Ω
- Rg = 0.5 Ω
- L = 30 µH = 0.00003 H

## 非线性器件伏安特性（导通时）

- **D1、D2**：U(D1) = U(D2) = 0.75 + 0.00007·i(t)
- **SCR1**：U(SCR1) = 0.88 + 0.000052·i(t)

**电子旁路总特性**（D1 + D2 + SCR1串联）：
- 阈值电压：U_threshold = 0.75 + 0.75 + 0.88 = **2.38 V**
- 总等效电阻：R_total = 0.00007 + 0.00007 + 0.000052 = **0.000192 Ω**
- **注意**：由于实际电路是整流桥电路，L-D1-D2-SCR1支路始终导通
- 导通时：u_bypass = 2.38 + 0.000192·i_L

## 状态方程推导

### 1. 状态变量选择

- **u_C**：电容电压（也是R两端电压，以及L-D1-D2-SCR1支路总电压）
- **i_L**：电感电流（也是L-D1-D2-SCR1支路电流，因为串联）

### 2. KCL方程（在电流源节点）

```
i_s(t) = i_L + i_R + i_C
```

其中：
- i_L：电感电流（也是L-D1-D2-SCR1支路电流，因为串联）
- i_R = u_C / R：电阻电流
- i_C = C · du_C/dt：电容电流

**注意**：L和D1-D2-SCR1串联，所以它们的电流相同（i_L），不需要单独计算i_bypass。

### 3. 各支路方程

#### L-D1-D2-SCR1支路（串联）
由于L和D1-D2-SCR1串联，且与R、C并联：
```
u_C = u_L + u_bypass
```

其中：
- u_L = L · di_L/dt：电感两端电压
- u_bypass：电子旁路（D1-D2-SCR1）两端电压

**由于实际电路是整流桥电路，L-D1-D2-SCR1支路始终导通**：
```
u_bypass = 2.38 + 0.000192 · i_L
u_C = L · di_L/dt + 2.38 + 0.000192 · i_L
```
整理得到：
```
di_L/dt = (u_C - 2.38 - 0.000192 · i_L) / L
```

#### 电阻支路（R）
```
i_R = u_C / R
u_R = u_C
```

#### 电容支路（C）
```
i_C = C · du_C/dt
u_C = u_C（状态变量）
```
由KCL：
```
i_C = i_s - i_L - i_R
```
因此：
```
du_C/dt = (i_s - i_L - u_C/R) / C
```

#### Rg支路
```
i_Rg = i_s（由KCL）
u_Rg = i_Rg · Rg = i_s · Rg
```

### 4. 状态方程（最终形式）

**由于L-D1-D2-SCR1支路始终导通**：
```
du_C/dt = (i_s(t) - i_L - u_C/R) / C
di_L/dt = (u_C - 2.38 - 0.000192 · i_L) / L
```

**注意**：由于实际电路是整流桥电路，不需要判断导通/不导通状态，始终使用上述方程。

### 5. 各支路电压关系

- **u_C**：C两端电压（也是R两端电压，以及L-D1-D2-SCR1支路总电压）
- **u_bypass = 2.38 + 0.000192·i_L**：电子旁路两端电压（始终导通）
- **u_L = u_C - u_bypass**：电感两端电压
- **u_Rg = i_s · Rg**：Rg两端电压
- **u_s = u_C + u_Rg**：电流源两端电压（由KVL）

## 数值求解方法

使用 `scipy.integrate.solve_ivp` 求解状态方程：

1. **状态变量**：y = [u_C, i_L]
2. **初始条件**：
   - u_C(200µs)：从Stage 1的最终值继承
   - i_L(200µs) = 0（假设电感初始电流为0）
3. **时间范围**：200微秒到50毫秒
4. **采样间隔**：10微秒

## 需要计算的量

1. **L-D1-D2-SCR1支路**（串联）：
   - i_L（也是i_bypass，因为串联，电流相同）
   - u_L = L · di_L/dt（电感两端电压）
   - u_bypass = u_C - u_L（电子旁路两端电压）

2. **R支路**：
   - i_R = u_C/R
   - u_R = u_C

3. **C支路**：
   - i_C = i_s - i_L - i_R（由KCL）
   - u_C（状态变量）

4. **Rg支路**：
   - i_Rg = i_s（由KCL）
   - u_Rg = i_s·Rg

## 注意事项

1. **L和D1-D2-SCR1串联**：L和电子旁路（D1-D2-SCR1）串联组成一个支路，它们的电流相同（i_L = i_bypass）。这个支路与R、C并联。

2. **始终导通**：由于实际电路是整流桥电路，L-D1-D2-SCR1支路始终导通，不需要判断导通/不导通状态。这简化了状态方程，避免了数值不连续问题。

3. **初始条件继承**：Stage 2的初始条件（u_C(200µs)）需要从Stage 1的最终值继承。i_L(200µs)通常为0。

4. **数值稳定性**：由于非线性器件的存在，可能需要使用更严格的求解器容差或更稳定的求解方法。但由于始终导通，避免了导通/不导通切换导致的数值不连续问题。

